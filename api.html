
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tools to automate PDFs containing white box field placeholders">
      
      
        <meta name="author" content="flywire">
      
      
        <link rel="canonical" href="https://flywire.github.io/flyfield/api.html">
      
      
        <link rel="prev" href="faq.html">
      
      
        <link rel="next" href="config.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>API Documentation - flyfield Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation-for-flyfield" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="flyfield Documentation" class="md-header__button md-logo" aria-label="flyfield Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            flyfield Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/flywire/flyfield" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    flyfield
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="flyfield Documentation" class="md-nav__button md-logo" aria-label="flyfield Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    flyfield Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flywire/flyfield" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    flyfield
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="quick_start.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="usage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Worked Example
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="process.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Process Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Documentation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="api.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Documentation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-modules-and-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Key Modules and Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Modules and Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-extraction-extractpy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Extraction (extract.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-layout-layoutpy" class="md-nav__link">
    <span class="md-ellipsis">
      2. Layout (layout.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-csv-io-io_utilspy" class="md-nav__link">
    <span class="md-ellipsis">
      3. CSV I/O (io_utils.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-markup-and-field-scripts-markup_and_fieldspy" class="md-nav__link">
    <span class="md-ellipsis">
      4. Markup and Field Scripts (markup_and_fields.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-utilities-utilspy" class="md-nav__link">
    <span class="md-ellipsis">
      5. Utilities (utils.py)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Field Data Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Further Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Core Modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.extract" class="md-nav__link">
    <span class="md-ellipsis">
      extract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.extract_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.filter_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      filter_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.remove_duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      remove_duplicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.sort_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      sort_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.process_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      process_boxes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.io_utils" class="md-nav__link">
    <span class="md-ellipsis">
      io_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="io_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.load_boxes_from_csv" class="md-nav__link">
    <span class="md-ellipsis">
      load_boxes_from_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.write_csv" class="md-nav__link">
    <span class="md-ellipsis">
      write_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.read_csv_rows" class="md-nav__link">
    <span class="md-ellipsis">
      read_csv_rows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.save_pdf_form_data_to_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_pdf_form_data_to_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.layout" class="md-nav__link">
    <span class="md-ellipsis">
      layout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.layout.calculate_layout_fields" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_layout_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.layout.assign_numeric_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      assign_numeric_blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields" class="md-nav__link">
    <span class="md-ellipsis">
      markup_and_fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="markup_and_fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.markup_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      markup_pdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.adjust_form_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_form_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.generate_form_fields_script" class="md-nav__link">
    <span class="md-ellipsis">
      generate_form_fields_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.run_standalone_script" class="md-nav__link">
    <span class="md-ellipsis">
      run_standalone_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.run_fill_pdf_fields" class="md-nav__link">
    <span class="md-ellipsis">
      run_fill_pdf_fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.add_suffix_to_filename" class="md-nav__link">
    <span class="md-ellipsis">
      add_suffix_to_filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.colour_match" class="md-nav__link">
    <span class="md-ellipsis">
      colour_match
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.int_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      int_to_rgb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.clean_fill_string" class="md-nav__link">
    <span class="md-ellipsis">
      clean_fill_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.allowed_text" class="md-nav__link">
    <span class="md-ellipsis">
      allowed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.format_money_space" class="md-nav__link">
    <span class="md-ellipsis">
      format_money_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.parse_money_space" class="md-nav__link">
    <span class="md-ellipsis">
      parse_money_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.parse_implied_decimal" class="md-nav__link">
    <span class="md-ellipsis">
      parse_implied_decimal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.version" class="md-nav__link">
    <span class="md-ellipsis">
      version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.parse_pages" class="md-nav__link">
    <span class="md-ellipsis">
      parse_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.conditional_merge_list" class="md-nav__link">
    <span class="md-ellipsis">
      conditional_merge_list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="developer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="glossary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-modules-and-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Key Modules and Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Modules and Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-extraction-extractpy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Extraction (extract.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-layout-layoutpy" class="md-nav__link">
    <span class="md-ellipsis">
      2. Layout (layout.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-csv-io-io_utilspy" class="md-nav__link">
    <span class="md-ellipsis">
      3. CSV I/O (io_utils.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-markup-and-field-scripts-markup_and_fieldspy" class="md-nav__link">
    <span class="md-ellipsis">
      4. Markup and Field Scripts (markup_and_fields.py)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-utilities-utilspy" class="md-nav__link">
    <span class="md-ellipsis">
      5. Utilities (utils.py)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Field Data Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Further Resources
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Core Modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.extract" class="md-nav__link">
    <span class="md-ellipsis">
      extract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.extract_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      extract_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.filter_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      filter_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.remove_duplicates" class="md-nav__link">
    <span class="md-ellipsis">
      remove_duplicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.sort_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      sort_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.extract.process_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      process_boxes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.io_utils" class="md-nav__link">
    <span class="md-ellipsis">
      io_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="io_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.load_boxes_from_csv" class="md-nav__link">
    <span class="md-ellipsis">
      load_boxes_from_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.write_csv" class="md-nav__link">
    <span class="md-ellipsis">
      write_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.read_csv_rows" class="md-nav__link">
    <span class="md-ellipsis">
      read_csv_rows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.io_utils.save_pdf_form_data_to_csv" class="md-nav__link">
    <span class="md-ellipsis">
      save_pdf_form_data_to_csv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.layout" class="md-nav__link">
    <span class="md-ellipsis">
      layout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.layout.calculate_layout_fields" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_layout_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.layout.assign_numeric_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      assign_numeric_blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields" class="md-nav__link">
    <span class="md-ellipsis">
      markup_and_fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="markup_and_fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.markup_pdf" class="md-nav__link">
    <span class="md-ellipsis">
      markup_pdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.adjust_form_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_form_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.generate_form_fields_script" class="md-nav__link">
    <span class="md-ellipsis">
      generate_form_fields_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.run_standalone_script" class="md-nav__link">
    <span class="md-ellipsis">
      run_standalone_script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.markup_and_fields.run_fill_pdf_fields" class="md-nav__link">
    <span class="md-ellipsis">
      run_fill_pdf_fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flyfield.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.add_suffix_to_filename" class="md-nav__link">
    <span class="md-ellipsis">
      add_suffix_to_filename
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.colour_match" class="md-nav__link">
    <span class="md-ellipsis">
      colour_match
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.int_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      int_to_rgb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.clean_fill_string" class="md-nav__link">
    <span class="md-ellipsis">
      clean_fill_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.allowed_text" class="md-nav__link">
    <span class="md-ellipsis">
      allowed_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.format_money_space" class="md-nav__link">
    <span class="md-ellipsis">
      format_money_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.parse_money_space" class="md-nav__link">
    <span class="md-ellipsis">
      parse_money_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.parse_implied_decimal" class="md-nav__link">
    <span class="md-ellipsis">
      parse_implied_decimal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.version" class="md-nav__link">
    <span class="md-ellipsis">
      version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.parse_pages" class="md-nav__link">
    <span class="md-ellipsis">
      parse_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flyfield.utils.conditional_merge_list" class="md-nav__link">
    <span class="md-ellipsis">
      conditional_merge_list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/flywire/flyfield/edit/main/docs/api.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="api-documentation-for-flyfield">API Documentation for flyfield</h1>
<p>This documentation provides a detailed reference to the <strong>flyfield</strong> Python API for programmatically working with PDF forms that use <strong>white box placeholders</strong>.</p>
<div class="admonition info">
<p class="admonition-title">Overview</p>
<p>The flyfield API automates workflows including:</p>
<ul>
<li>Extracting <em>white box placeholders</em> from vector PDFs</li>
<li>Filtering, deduplicating, and grouping detected regions into logical fields</li>
<li>Generating interactive <strong>AcroForm</strong> fields in PDFs programmatically</li>
<li>Filling form fields with data from CSV files</li>
<li>Capturing data back from filled PDFs into CSV</li>
</ul>
</div>
<p>The API is modular and can be imported into Python projects, offering programmable control beyond the CLI.</p>
<hr />
<h2 id="key-modules-and-functions">Key Modules and Functions</h2>
<h3 id="1-extraction-extractpy">1. Extraction (<code>extract.py</code>)</h3>
<ul>
<li><strong><code>extract_boxes(pdf_path: str) -&gt; List[dict]</code></strong>
Extracts all white boxes from a PDF that match <code>config.TARGET_COLOUR</code> (pure white by default).<ul>
<li>Converts coordinates to the standard bottom-left PDF system.</li>
<li>Returns a list of box dictionaries with metadata such as <code>page_num</code>, <code>bbox</code>, <code>chars</code>, and <code>field_type</code>.</li>
</ul>
</li>
<li><strong><code>filter_boxes(page: fitz.Page, boxes: List[dict]) -&gt; List[dict]</code></strong>
Filters raw boxes by:<ul>
<li>Size (<code>MIN_BOX_HEIGHT</code>, <code>MAX_BOX_HEIGHT</code>)</li>
<li>Allowed text (<code>utils.allowed_text</code>)</li>
<li>Retains only candidate placeholders.</li>
</ul>
</li>
<li><strong><code>remove_duplicates(boxes: List[dict]) -&gt; List[dict]</code></strong>
Removes duplicates based on rounded coordinates on each page.</li>
<li><strong><code>sort_boxes(boxes: List[dict], decimal_places: int=0) -&gt; List[dict]</code></strong>
Sorts results <strong>top-to-bottom, then left-to-right</strong>.</li>
<li>
<p><strong><code>process_boxes(pdf_path: str, csv_path: str) -&gt; Dict[int, List[dict]]</code></strong>
Full extraction pipeline:</p>
</li>
<li>
<p>Extract → Filter → Deduplicate → Sort</p>
</li>
<li>Compute layout fields (<code>calculate_layout_fields</code>)</li>
<li>Assign numeric block types (<code>assign_numeric_blocks</code>)</li>
<li>Save annotated results to CSV
Returns a dictionary keyed by <code>page_num</code>.</li>
</ul>
<hr />
<h3 id="2-layout-layoutpy">2. Layout (<code>layout.py</code>)</h3>
<ul>
<li><strong><code>calculate_layout_fields(boxes: List[dict]) -&gt; Dict[int, List[dict]]</code></strong>
Annotates box rows with:<ul>
<li>IDs, line numbers, block grouping</li>
<li>Block length/width</li>
<li>Concatenated <code>block_fill</code> text or formatted money values</li>
</ul>
</li>
<li><strong><code>assign_numeric_blocks(page_dict: Dict[int, List[dict]]) -&gt; Dict[int, List[dict]]</code></strong>
Merges sequential numeric blocks (e.g. <code>### ### ##</code> patterns) into currency fields.<ul>
<li>Assigns <code>"Currency"</code> or <code>"CurrencyDecimal"</code> where applicable.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="3-csv-io-io_utilspy">3. CSV I/O (<code>io_utils.py</code>)</h3>
<ul>
<li><strong><code>load_boxes_from_csv(csv_path: str) -&gt; Dict[int, List[dict]]</code></strong>
Reads CSV data into a page dictionary for further processing.</li>
<li><strong><code>write_csv(data, csv_path: str) -&gt; None</code></strong>
Writes box/page data back to CSV in canonical format.<ul>
<li>Ensures only one <code>fill</code> column is stored (<code>block_fill</code> or fallback <code>fill</code>).</li>
</ul>
</li>
<li><strong><code>read_csv_rows(filename: str) -&gt; List[dict]</code></strong>
Reads CSV into dictionaries, parsing numeric fills with <code>parse_money_space</code> or <code>parse_implied_decimal</code>.</li>
<li><strong><code>save_pdf_form_data_to_csv(pdf_path: str, csv_path: str, boxes: dict=None) -&gt; None</code></strong>
Captures filled AcroForm values from a PDF and writes them to CSV.<ul>
<li>Applies <code>NUMERIC_FIELD_TYPES</code> parsing rules.</li>
<li>Uppercases strings where applicable.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="4-markup-and-field-scripts-markup_and_fieldspy">4. Markup and Field Scripts (<code>markup_and_fields.py</code>)</h3>
<ul>
<li><strong><code>markup_pdf(pdf_path: str, page_dict: Dict[int,List[dict]], output_pdf: str, mark_color=(0,0,1)) -&gt; None</code></strong>
Creates a <strong>debug PDF</strong> marking detected fields with circles and rotated field codes.</li>
<li><strong><code>generate_form_fields_script(csv_path: str, input_pdf: str, output_pdf: str, script_path: str) -&gt; str</code></strong>
Generates a <strong>standalone Python script</strong> that adds AcroForm fields to a given PDF, based on detected CSV data.</li>
<li><strong><code>run_standalone_script(script_path: str) -&gt; None</code></strong>
Executes the generated script in a subprocess to apply fields.</li>
<li><strong><code>run_fill_pdf_fields(csv_path: str, output_pdf: str, template_pdf: str, generator_script: str, boxes: dict=None) -&gt; None</code></strong>
Generates and runs a filler script that populates an interactive PDF with values from a CSV.<ul>
<li>Supports monetary formatting via <code>format_money_space</code>.</li>
<li>Supports normalization of Currency/CurrencyDecimal values by stripping non-digits.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="5-utilities-utilspy">5. Utilities (<code>utils.py</code>)</h3>
<ul>
<li><strong><code>add_suffix_to_filename(filename: str, suffix: str) -&gt; str</code></strong>
Adds a suffix before the file extension.</li>
<li><strong><code>colour_match(color: Tuple, target_color=(1,1,1), tol=1e-3) -&gt; bool</code></strong>
Compares normalized RGB colors with tolerance.</li>
<li><strong><code>int_to_rgb(color_int: int) -&gt; Tuple[float,float,float]</code></strong>
Converts an integer 0xRRGGBB color to normalized floats.</li>
<li><strong><code>clean_fill_string(line_text: str) -&gt; str</code></strong>
Removes single spaces but preserves aligned spacing.</li>
<li><strong><code>allowed_text(text: str, field_type: Optional[str]) -&gt; Tuple[bool, Optional[str]]</code></strong>
Checks whether a string value inside a field is allowed (filters out pre-printed text).</li>
<li><strong><code>format_money_space(amount: Union[float,int], decimal=True) -&gt; str</code></strong>
Formats numeric values with:<ul>
<li>Space as thousand separator</li>
<li>Space as decimal marker (if decimal=True)</li>
</ul>
</li>
<li><strong><code>parse_money_space(s: str, decimal=True) -&gt; Union[int,float]</code></strong>
Parses strings formatted above back into numbers.</li>
<li><strong><code>parse_implied_decimal(s: str) -&gt; float</code></strong>
Parses numbers treating the last two digits as cents.</li>
<li><strong><code>parse_pages(pages_str: str) -&gt; List[int]</code></strong>
Parses <code>"1,3-5,7"</code> into <code>[1,3,4,5,7]</code>.</li>
<li><strong><code>conditional_merge_list(main_list, ref_list, match_key, keys_to_merge)</code></strong>
Merges keys from a reference list into a main list when values of <code>match_key</code> match.</li>
</ul>
<hr />
<h2 id="field-data-structure">Field Data Structure</h2>
<p>flyfield represents form fields as dictionaries (not classes):</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Key</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>code</code></td>
<td style="text-align: left;">str</td>
<td style="text-align: left;">Unique identifier (<code>page-line-block</code> naming scheme)</td>
</tr>
<tr>
<td style="text-align: left;"><code>page_num</code></td>
<td style="text-align: left;">int</td>
<td style="text-align: left;">PDF page number (1-based)</td>
</tr>
<tr>
<td style="text-align: left;"><code>x0,y0,x1,y1</code></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">Bounding box coordinates (PDF bottom-left system)</td>
</tr>
<tr>
<td style="text-align: left;"><code>left, right</code></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">Rounded left/right coordinates</td>
</tr>
<tr>
<td style="text-align: left;"><code>top, bottom</code></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">Rounded positions</td>
</tr>
<tr>
<td style="text-align: left;"><code>line</code></td>
<td style="text-align: left;">int</td>
<td style="text-align: left;">Line number on page</td>
</tr>
<tr>
<td style="text-align: left;"><code>block</code></td>
<td style="text-align: left;">int</td>
<td style="text-align: left;">Block number within line</td>
</tr>
<tr>
<td style="text-align: left;"><code>block_length</code></td>
<td style="text-align: left;">int</td>
<td style="text-align: left;">Number of boxes in block</td>
</tr>
<tr>
<td style="text-align: left;"><code>block_width</code></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">Width of block in points</td>
</tr>
<tr>
<td style="text-align: left;"><code>field_type</code></td>
<td style="text-align: left;">str</td>
<td style="text-align: left;">One of <code>"Dollars"</code>, <code>"DollarCents"</code>, <code>"Currency"</code>, etc.</td>
</tr>
<tr>
<td style="text-align: left;"><code>chars</code></td>
<td style="text-align: left;">str</td>
<td style="text-align: left;">Non-black overlay text extracted</td>
</tr>
<tr>
<td style="text-align: left;"><code>fill</code></td>
<td style="text-align: left;">str/num</td>
<td style="text-align: left;">Overlay text (user values, may be pre-filled)</td>
</tr>
<tr>
<td style="text-align: left;"><code>block_fill</code></td>
<td style="text-align: left;">str/num</td>
<td style="text-align: left;">Aggregated/normalized block fill</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="example-usage">Example Usage</h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">flyfield.extract</span><span class="w"> </span><span class="kn">import</span> <span class="n">process_boxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flyfield.io_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_pdf_form_data_to_csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flyfield.markup_and_fields</span><span class="w"> </span><span class="kn">import</span>  <span class="n">run_fill_pdf_fields</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flyfield</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>

<span class="c1"># Process boxes and save CSV</span>
<span class="n">page_dict</span> <span class="o">=</span> <span class="n">process_boxes</span><span class="p">(</span><span class="s2">&quot;example.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;example.csv&quot;</span><span class="p">)</span>

<span class="c1"># Generate a markup PDF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flyfield.markup_and_fields</span><span class="w"> </span><span class="kn">import</span> <span class="n">markup_pdf</span>
<span class="n">markup_pdf</span><span class="p">(</span><span class="s2">&quot;example.pdf&quot;</span><span class="p">,</span> <span class="n">page_dict</span><span class="p">,</span> <span class="s2">&quot;example-markup.pdf&quot;</span><span class="p">)</span>

<span class="c1"># Fill fields with values from another CSV</span>
<span class="n">run_fill_pdf_fields</span><span class="p">(</span><span class="s2">&quot;example.csv&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;example-filled.pdf&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;example-fields.pdf&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;example-filler.py&quot;</span><span class="p">,</span>
                    <span class="n">page_dict</span><span class="p">)</span>

<span class="c1"># Capture back to CSV after filling</span>
<span class="n">save_pdf_form_data_to_csv</span><span class="p">(</span><span class="s2">&quot;example-filled.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;example-capture.csv&quot;</span><span class="p">,</span> <span class="n">page_dict</span><span class="p">)</span>
</code></pre></div>
<hr />
<div class="admonition info">
<p class="admonition-title">Info</p>
<ul>
<li>flyfield depends on <strong>PyMuPDF</strong> (<code>fitz</code>) for box extraction and markup, and <strong>PyPDFForm</strong> for form field creation and filling.</li>
<li>Monetary/Currency parsing is opinionated.</li>
<li>All generated scripts (<code>-field-generator.py</code>, <code>-filler.py</code>) are standalone and reusable in case of workflow adjustments.</li>
<li>Debug logging (<code>--debug</code>) outputs stepwise CSVs for troubleshooting.</li>
</ul>
</div>
<hr />
<h2 id="further-resources">Further Resources</h2>
<ul>
<li><a href="config.html">Configuration Reference</a> — adjustable thresholds and suffixes</li>
<li><a href="developer.html">Developer Guide</a> — core architecture and extension points</li>
<li><a href="example.html">Worked Example</a> — end-to-end workflow with CSV integration</li>
</ul>
<hr />
<p>Automatic documentation from sources by <a href="https://mkdocstrings.github.io/">mkdocstrings</a>.</p>
<h2 id="core-modules">Core Modules</h2>


<div class="doc doc-object doc-module">



<h2 id="flyfield.extract" class="doc doc-heading">
            <code>flyfield.extract</code>


</h2>

    <div class="doc doc-contents first">

        <p>Extraction functions for PDF processing.</p>
<p>Provides methods to extract PDF box data and text.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="flyfield.extract.extract_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_boxes</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract filled rectangles (boxes) from a PDF matching a target color.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the input PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of dict: Each dict details box coordinates (PDF coordinates, origin bottom-left),</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>page number, and other metadata for detected boxes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Converts PyMuPDF coordinates (origin top-left) to PDF standard bottom-left origin.
Only boxes filled with the target color are extracted.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/extract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_boxes</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract filled rectangles (boxes) from a PDF matching a target color.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdf_path (str): Path to the input PDF file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of dict: Each dict details box coordinates (PDF coordinates, origin bottom-left),</span>
<span class="sd">        page number, and other metadata for detected boxes.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Converts PyMuPDF coordinates (origin top-left) to PDF standard bottom-left origin.</span>
<span class="sd">        Only boxes filled with the target color are extracted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">doc</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">page_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Page </span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2"> not found in document.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">page_height</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span>
                <span class="k">for</span> <span class="n">drawing</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get_drawings</span><span class="p">():</span>
                    <span class="n">rect</span> <span class="o">=</span> <span class="n">drawing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">)</span>
                    <span class="n">fill_color</span> <span class="o">=</span> <span class="n">drawing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rect</span> <span class="ow">and</span> <span class="n">colour_match</span><span class="p">(</span><span class="n">fill_color</span><span class="p">,</span> <span class="n">target_color</span><span class="o">=</span><span class="n">TARGET_COLOUR</span><span class="p">):</span>
                        <span class="c1"># Convert PyMuPDF page coordinates (origin top-left)</span>
                        <span class="c1"># to PDF coordinate system (origin bottom-left)</span>

                        <span class="n">pdf_y0</span> <span class="o">=</span> <span class="n">page_height</span> <span class="o">-</span> <span class="n">rect</span><span class="o">.</span><span class="n">y1</span>
                        <span class="n">pdf_y1</span> <span class="o">=</span> <span class="n">page_height</span> <span class="o">-</span> <span class="n">rect</span><span class="o">.</span><span class="n">y0</span>
                        <span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;page_num&quot;</span><span class="p">:</span> <span class="n">page_num</span><span class="p">,</span>
                                <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span>
                                <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">pdf_y0</span><span class="p">,</span>
                                <span class="s2">&quot;x1&quot;</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span>
                                <span class="s2">&quot;y1&quot;</span><span class="p">:</span> <span class="n">pdf_y1</span><span class="p">,</span>
                                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">pdf_y0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">pdf_y1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="s2">&quot;chars&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;field_type&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not open PDF file </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">boxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.extract.filter_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_boxes</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">boxes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Filter a list of boxes on a PDF page based on height and allowed text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page</code>
            </td>
            <td>
                  <code><span title="fitz.Page">Page</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PyMuPDF page object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boxes</code>
            </td>
            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of box dictionaries to filter.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of dict: Filtered boxes that meet size and allowed text criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Excludes boxes outside valid height ranges or with disallowed text.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/extract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_boxes</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Page</span><span class="p">,</span> <span class="n">boxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter a list of boxes on a PDF page based on height and allowed text.</span>

<span class="sd">    Args:</span>
<span class="sd">        page (fitz.Page): PyMuPDF page object.</span>
<span class="sd">        boxes (list of dict): List of box dictionaries to filter.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of dict: Filtered boxes that meet size and allowed text criteria.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Excludes boxes outside valid height ranges or with disallowed text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">page_height</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span>
    <span class="n">black</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># RGB for black text matching</span>

    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="n">MIN_BOX_HEIGHT</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="n">MAX_BOX_HEIGHT</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Convert box coordinates to PyMuPDF&#39;s coordinate system for clipping</span>

        <span class="n">pymupdf_y0</span> <span class="o">=</span> <span class="n">page_height</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span>
        <span class="n">pymupdf_y1</span> <span class="o">=</span> <span class="n">page_height</span> <span class="o">-</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">]</span>
        <span class="n">clip_rect</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span> <span class="n">pymupdf_y0</span><span class="p">,</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="n">pymupdf_y1</span><span class="p">)</span>

        <span class="n">text_dict</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">clip_rect</span><span class="p">)</span>

        <span class="n">black_text_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">non_black_text_parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">text_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;blocks&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spans&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">span_text</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">span_text</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">span_color</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">)</span>
                    <span class="n">rgb</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">span_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span_color</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                            <span class="n">rgb</span> <span class="o">=</span> <span class="n">int_to_rgb</span><span class="p">(</span><span class="n">span_color</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span_color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">rgb</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">span_color</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                <span class="n">rgb</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">rgb</span> <span class="ow">and</span> <span class="n">colour_match</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">target_color</span><span class="o">=</span><span class="n">black</span><span class="p">):</span>
                        <span class="n">black_text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span_text</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">non_black_text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span_text</span><span class="p">)</span>
        <span class="n">fill_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">black_text_parts</span><span class="p">)</span>
        <span class="n">box_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">non_black_text_parts</span><span class="p">)</span>

        <span class="n">allowed</span><span class="p">,</span> <span class="n">detected_field_type</span> <span class="o">=</span> <span class="n">allowed_text</span><span class="p">(</span>
            <span class="n">box_text</span><span class="p">,</span> <span class="n">field_type</span><span class="o">=</span><span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">box_text</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">box</span><span class="p">[</span><span class="s2">&quot;field_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detected_field_type</span>
        <span class="n">box</span><span class="p">[</span><span class="s2">&quot;chars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_text</span>
        <span class="n">box</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_text</span>
        <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filtered</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.extract.remove_duplicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove duplicate boxes on the same page based on rounded coordinates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boxes</code>
            </td>
            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of box dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of dict: Boxes with duplicates removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/extract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">boxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove duplicate boxes on the same page based on rounded coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        boxes (list of dict): List of box dictionaries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of dict: Boxes with duplicates removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">page_groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
        <span class="n">page_groups</span><span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="n">cleaned</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_page_num</span><span class="p">,</span> <span class="n">page_boxes</span> <span class="ow">in</span> <span class="n">page_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">page_boxes</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
                <span class="nb">round</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cleaned</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.extract.sort_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sort_boxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sort boxes by page number, top-to-bottom (descending), then left-to-right.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boxes</code>
            </td>
            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of boxes to sort.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Precision for vertical grouping (bottom coordinate rounding).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of dict: Sorted boxes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/extract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sort_boxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort boxes by page number, top-to-bottom (descending), then left-to-right.</span>

<span class="sd">    Args:</span>
<span class="sd">        boxes (list of dict): List of boxes to sort.</span>
<span class="sd">        decimal_places (int): Precision for vertical grouping (bottom coordinate rounding).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of dict: Sorted boxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">boxes</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">],</span> <span class="o">-</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">],</span> <span class="n">decimal_places</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.extract.process_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_boxes</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Full pipeline to extract, filter, deduplicate, sort, layout annotate, and save boxes from a PDF.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to input PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to output CSV file for annotated box data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="int">int</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary keyed by page number containing processed boxes with layout metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Extract filled white boxes matching TARGET_COLOUR.</li>
<li>Filter boxes by valid height and allowed text content.</li>
<li>Remove duplicate boxes by coordinate proximity.</li>
<li>Sort boxes by page, vertical then horizontal order.</li>
<li>Compute layout fields such as IDs, block grouping, lines.</li>
<li>Assign numeric block field types using heuristics.</li>
<li>Write the full annotated box data to CSV.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/extract.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_boxes</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Full pipeline to extract, filter, deduplicate, sort, layout annotate, and save boxes from a PDF.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdf_path (str): Path to input PDF file.</span>
<span class="sd">        csv_path (str): Path to output CSV file for annotated box data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary keyed by page number containing processed boxes with layout metadata.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Extract filled white boxes matching TARGET_COLOUR.</span>
<span class="sd">        - Filter boxes by valid height and allowed text content.</span>
<span class="sd">        - Remove duplicate boxes by coordinate proximity.</span>
<span class="sd">        - Sort boxes by page, vertical then horizontal order.</span>
<span class="sd">        - Compute layout fields such as IDs, block grouping, lines.</span>
<span class="sd">        - Assign numeric block field types using heuristics.</span>
<span class="sd">        - Write the full annotated box data to CSV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting boxes from PDF: </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">boxes</span> <span class="o">=</span> <span class="n">extract_boxes</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span><span class="si">}</span><span class="s2"> white boxes.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error opening input PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">write_csv</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;-extracted.csv&quot;</span><span class="p">))</span>
    <span class="n">filtered_boxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">page_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">boxes</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">page_num</span><span class="p">]</span>
        <span class="n">filtered_boxes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filter_boxes</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">page_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">page_boxes</span><span class="p">))</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">write_csv</span><span class="p">(</span><span class="n">filtered_boxes</span><span class="p">,</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;-grouped.csv&quot;</span><span class="p">))</span>
    <span class="n">filtered_boxes</span> <span class="o">=</span> <span class="n">remove_duplicates</span><span class="p">(</span><span class="n">filtered_boxes</span><span class="p">)</span>
    <span class="n">filtered_boxes</span> <span class="o">=</span> <span class="n">sort_boxes</span><span class="p">(</span><span class="n">filtered_boxes</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">write_csv</span><span class="p">(</span><span class="n">filtered_boxes</span><span class="p">,</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;-filtered.csv&quot;</span><span class="p">))</span>
    <span class="n">page_dict</span> <span class="o">=</span> <span class="n">calculate_layout_fields</span><span class="p">(</span><span class="n">filtered_boxes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">isEnabledFor</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">):</span>
        <span class="n">write_csv</span><span class="p">(</span><span class="n">filtered_boxes</span><span class="p">,</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;-layout.csv&quot;</span><span class="p">))</span>
    <span class="n">page_dict</span> <span class="o">=</span> <span class="n">assign_numeric_blocks</span><span class="p">(</span><span class="n">page_dict</span><span class="p">)</span>

    <span class="n">write_csv</span><span class="p">(</span><span class="n">page_dict</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">page_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="flyfield.io_utils" class="doc doc-heading">
            <code>flyfield.io_utils</code>


</h2>

    <div class="doc doc-contents first">

        <p>Utility functions for input/output operations.</p>
<p>Includes CSV reading/writing and data transformation helpers.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="flyfield.io_utils.load_boxes_from_csv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_boxes_from_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load boxes data from a CSV into a dictionary keyed by page number,</p>
<p>applying the specified types to each column in the CSV.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="int">int</span>, <span title="list">list</span>[<span title="dict">dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[int, list[dict]]: Dictionary mapping page number (int)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="int">int</span>, <span title="list">list</span>[<span title="dict">dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>to a list of box dictionaries with appropriately typed values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="description" open>
  <summary>Description</summary>
  <p>The CSV is expected to contain columns:</p>
<ul>
<li>page_num (int), id (int), x0 (float), y0 (float), x1 (float), y1 (float),</li>
<li>left (float), top (float), right (float), bottom (float),</li>
<li>height (float), width (float), pgap (float), gap (float),</li>
<li>line (int), block (int), block_length (int), block_width (float),</li>
<li>code (str), field_type (str), chars (str), fill (str)</li>
</ul>
<p>Each value from the CSV is converted from string to the appropriate type.
Empty or missing values are converted to None for numeric types and empty string for strings.
Conversion errors are caught and logged; original strings are kept in those cases.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/io_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_boxes_from_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load boxes data from a CSV into a dictionary keyed by page number,</span>

<span class="sd">    applying the specified types to each column in the CSV.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_path (str): Path to the CSV file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[int, list[dict]]: Dictionary mapping page number (int)</span>
<span class="sd">        to a list of box dictionaries with appropriately typed values.</span>

<span class="sd">    Description:</span>
<span class="sd">        The CSV is expected to contain columns:</span>

<span class="sd">        - page_num (int), id (int), x0 (float), y0 (float), x1 (float), y1 (float),</span>
<span class="sd">        - left (float), top (float), right (float), bottom (float),</span>
<span class="sd">        - height (float), width (float), pgap (float), gap (float),</span>
<span class="sd">        - line (int), block (int), block_length (int), block_width (float),</span>
<span class="sd">        - code (str), field_type (str), chars (str), fill (str)</span>

<span class="sd">        Each value from the CSV is converted from string to the appropriate type.</span>
<span class="sd">        Empty or missing values are converted to None for numeric types and empty string for strings.</span>
<span class="sd">        Conversion errors are caught and logged; original strings are kept in those cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading blocks from CSV: </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">read_csv_rows</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>  <span class="c1"># Should return list of dict[str, str]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">to_type</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">to_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to convert value &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; to </span><span class="si">{</span><span class="n">to_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>  <span class="c1"># fallback: keep original string</span>

    <span class="n">page_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">typed_row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">col</span><span class="p">:</span> <span class="n">convert_value</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">col_type</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">col_type</span> <span class="ow">in</span> <span class="n">COLUMN_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">typed_row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_num&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">page_dict</span><span class="p">[</span><span class="n">typed_row</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">typed_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">page_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.io_utils.write_csv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_csv</span><span class="p">(</span><span class="n">boxes_or_page_dict</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Write box data or page dictionary data to CSV file.</p>
<p>Saves only one 'fill' column:
    - Uses 'block_fill' if present,
    - Otherwise falls back to original 'fill'.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boxes_or_page_dict</code>
            </td>
            <td>
                  <code><span title="list">list</span> or <span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of box dicts or dict keyed by page containing lists of boxes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output CSV file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/io_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_csv</span><span class="p">(</span>
    <span class="n">boxes_or_page_dict</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]],</span> <span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write box data or page dictionary data to CSV file.</span>

<span class="sd">    Saves only one &#39;fill&#39; column:</span>
<span class="sd">        - Uses &#39;block_fill&#39; if present,</span>
<span class="sd">        - Otherwise falls back to original &#39;fill&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        boxes_or_page_dict (list or dict): List of box dicts or dict keyed by page containing lists of boxes.</span>
<span class="sd">        csv_path (str): Output CSV file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boxes_or_page_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">all_boxes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">box</span>
            <span class="k">for</span> <span class="n">boxes</span> <span class="ow">in</span> <span class="n">boxes_or_page_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">boxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_boxes</span> <span class="o">=</span> <span class="n">boxes_or_page_dict</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">CSV_HEADER</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">all_boxes</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">fill_value</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_fill&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fill_value</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span>
                <span class="c1"># Convert monetary fill values back to float/int as appropriate</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Dollars&quot;</span><span class="p">,</span> <span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">fill_value</span>
                <span class="p">):</span>
                    <span class="n">decimal</span> <span class="o">=</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fill_value</span> <span class="o">=</span> <span class="n">parse_money_space</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Failed to parse money from fill_value &#39;</span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&#39; for field_type &#39;</span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_num&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">height</span><span class="p">,</span>
                    <span class="n">width</span><span class="p">,</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pgap&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gap&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_width&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chars&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">fill_value</span><span class="p">,</span>
                <span class="p">]</span>

                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write CSV </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.io_utils.read_csv_rows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_csv_rows</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Read CSV rows into a list, converting typed fields and normalizing monetary fills.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to CSV file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of dict: Rows with typed values and block_fill normalized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/io_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_csv_rows</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read CSV rows into a list, converting typed fields and normalizing monetary fills.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Path to CSV file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of dict: Rows with typed values and block_fill normalized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">currency_field_types</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Dollars&quot;</span><span class="p">,</span> <span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;Currency&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">fieldnames</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">is_extraction_csv</span> <span class="o">=</span> <span class="s2">&quot;page_num&quot;</span> <span class="ow">in</span> <span class="n">headers</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_extraction_csv</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Convert page_num, line, gap, block_length, height, width fields to correct types</span>

                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="p">)</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;gap&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;gap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="mf">0.0</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">else</span> <span class="mi">0</span>
                        <span class="p">)</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping row due to value error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                <span class="c1"># Rearrange &#39;fill&#39; to &#39;block_fill&#39; with formatted monetary fields</span>

                <span class="k">if</span> <span class="s2">&quot;fill&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                    <span class="n">fill_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span>
                    <span class="n">field_type</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">currency_field_types</span> <span class="ow">and</span> <span class="n">fill_value</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="s2">&quot; &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fill_value</span>
                        <span class="p">):</span>
                            <span class="c1"># Use implied decimal parser for no explicit decimal separator</span>

                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">amount</span> <span class="o">=</span> <span class="n">parse_implied_decimal</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span>
                                <span class="n">fill_value</span> <span class="o">=</span> <span class="n">format_money_space</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Failed to parse implied decimal fill &#39;</span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&#39; for field_type &#39;</span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Use existing parser for explicit decimal formatting</span>

                            <span class="n">decimal</span> <span class="o">=</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">amount</span> <span class="o">=</span> <span class="n">parse_money_space</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
                                <span class="n">fill_value</span> <span class="o">=</span> <span class="n">format_money_space</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Failed to parse/format fill &#39;</span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&#39; for field_type &#39;</span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="p">)</span>
                        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_value</span>
                        <span class="k">del</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read CSV rows from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.io_utils.save_pdf_form_data_to_csv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_pdf_form_data_to_csv</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">,</span> <span class="n">boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract PDF form data, convert string values to uppercase and numeric fields to raw numbers, then save as CSV.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input PDF form file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output CSV path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boxes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boxes metadata to enrich form data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/io_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_pdf_form_data_to_csv</span><span class="p">(</span>
    <span class="n">pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">boxes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract PDF form data, convert string values to uppercase and numeric fields to raw numbers, then save as CSV.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdf_path (str): Input PDF form file path.</span>
<span class="sd">        csv_path (str): Output CSV path.</span>
<span class="sd">        boxes (dict, optional): Boxes metadata to enrich form data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Extract form data; convert string values to uppercase where applicable</span>

        <span class="n">form_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">PdfWrapper</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">}</span>
        <span class="c1"># Convert raw data dict to list of dicts with explicit &#39;code&#39; and &#39;value&#39; keys</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">form_data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract data from </span><span class="si">{</span><span class="n">pdf_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracted PDF form data (type=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">), count=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">boxes</span><span class="p">:</span>
        <span class="n">flat_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">boxes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">conditional_merge_list</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">flat_boxes</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;field_type&quot;</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="c1"># Write CSV header</span>

            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;fill&quot;</span><span class="p">])</span>

            <span class="c1"># Write each field record as a CSV row</span>

            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
                <span class="n">fill_value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">, Raw Value: </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">, Field Type: </span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">NUMERIC_FIELD_TYPES</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">:</span>
                            <span class="n">amount</span> <span class="o">=</span> <span class="n">parse_implied_decimal</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span>
                            <span class="n">fill_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>  <span class="c1"># Save raw number, not formatted!</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsed CurrencyDecimal: </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;Dollars&quot;</span><span class="p">):</span>
                            <span class="n">decimal</span> <span class="o">=</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;DollarCents&quot;</span>
                            <span class="n">amount</span> <span class="o">=</span> <span class="n">parse_money_space</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
                            <span class="n">fill_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>  <span class="c1"># Save raw number, not formatted!</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsed </span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Failed parsing money value &#39;</span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&#39; for field &#39;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">code</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write CSV file </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="flyfield.layout" class="doc doc-heading">
            <code>flyfield.layout</code>


</h2>

    <div class="doc doc-contents first">

        <p>Layout processing for PDFs.</p>
<p>Calculates layout box positions and formatting.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="flyfield.layout.calculate_layout_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_layout_fields</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Annotate boxes with layout metadata including IDs, lines, blocks,</p>
<p>block dimensions, monetary formatting, calculate block dimensions and
concatenated fill text per block.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>boxes</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of boxes sorted by page and vertical order.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="typing.DefaultDict">DefaultDict</span>[<span title="int">int</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping page numbers to lists of annotated boxes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Vertical tolerance epsilon controls grouping boxes into the same line.</li>
<li>Blocks are formed by grouping boxes separated by large gaps (GAP_THRESHOLD).</li>
<li>Monetary fills are formatted with spaces and decimals where appropriate.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/layout.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_layout_fields</span><span class="p">(</span><span class="n">boxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Annotate boxes with layout metadata including IDs, lines, blocks,</span>

<span class="sd">    block dimensions, monetary formatting, calculate block dimensions and</span>
<span class="sd">    concatenated fill text per block.</span>

<span class="sd">    Args:</span>
<span class="sd">        boxes (list): List of boxes sorted by page and vertical order.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Mapping page numbers to lists of annotated boxes.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Vertical tolerance epsilon controls grouping boxes into the same line.</span>
<span class="sd">        - Blocks are formed by grouping boxes separated by large gaps (GAP_THRESHOLD).</span>
<span class="sd">        - Monetary fills are formatted with spaces and decimals where appropriate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Vertical tolerance for grouping boxes into the same line</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_page</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">line_counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxes</span><span class="p">):</span>
        <span class="n">page_num</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;page_num&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">page_num</span> <span class="o">!=</span> <span class="n">current_page</span><span class="p">:</span>
            <span class="n">current_page</span> <span class="o">=</span> <span class="n">page_num</span>
            <span class="n">line_counter</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">block_id_counter</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Initialize first box in a new line and block</span>

        <span class="n">boxes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_counter</span><span class="p">,</span>
                <span class="s2">&quot;block_start&quot;</span><span class="p">:</span> <span class="n">block_id_counter</span><span class="p">,</span>
                <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">block_id_counter</span><span class="p">,</span>
                <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line_counter</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">block_id_counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pgap&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Gap before this box (none for first)</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">block_start</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c1"># Group boxes horizontally on the same line by bottom alignment and gap thresholds</span>

        <span class="k">while</span> <span class="p">(</span>
            <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;page_num&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">page_num</span>
            <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">boxes</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s2">&quot;bottom&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">epsilon</span>
        <span class="p">):</span>
            <span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_counter</span>
            <span class="n">prev_gap</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;x0&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">boxes</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;x1&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">&quot;pgap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_gap</span>
            <span class="n">boxes</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;gap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_gap</span>
            <span class="k">if</span> <span class="n">prev_gap</span> <span class="o">&gt;=</span> <span class="n">GAP_THRESHOLD</span><span class="p">:</span>
                <span class="c1"># Close current block and start a new block</span>

                <span class="n">end_idx</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">block_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_idx</span> <span class="o">-</span> <span class="n">block_start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">block_width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="n">end_idx</span><span class="p">][</span><span class="s2">&quot;x1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_length</span>
                <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;block_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_width</span>
                <span class="n">current_box</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">current_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;Dollars&quot;</span><span class="p">):</span>
                    <span class="n">raw_fill</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span> <span class="p">:</span> <span class="n">end_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;block_fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_fill_string</span><span class="p">(</span><span class="n">raw_fill</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">decimal</span> <span class="o">=</span> <span class="n">current_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;DollarCents&quot;</span>
                    <span class="n">fill_val</span> <span class="o">=</span> <span class="n">current_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fill_val</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">fill_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">fill_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">current_box</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_money_space</span><span class="p">(</span><span class="n">fill_val</span><span class="p">,</span> <span class="n">decimal</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to format fill value &#39;</span><span class="si">{</span><span class="n">fill_val</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="c1"># fall back to original fill value if formatting fails</span>

                        <span class="n">current_box</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_val</span>
                <span class="n">block_id_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">block_start</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;block_start&quot;</span><span class="p">:</span> <span class="n">block_id_counter</span><span class="p">,</span>
                        <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">block_id_counter</span><span class="p">,</span>
                        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line_counter</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">block_id_counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Continue current block</span>

                <span class="n">boxes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;block_start&quot;</span><span class="p">:</span> <span class="n">block_id_counter</span><span class="p">,</span>
                        <span class="s2">&quot;block&quot;</span><span class="p">:</span> <span class="n">block_id_counter</span><span class="p">,</span>
                        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">page_num</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">line_counter</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">block_id_counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Close last block on the line</span>

        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">block_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_idx</span> <span class="o">-</span> <span class="n">block_start</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">block_width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="n">end_idx</span><span class="p">][</span><span class="s2">&quot;x1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;x0&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_length</span>
        <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;block_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_width</span>
        <span class="n">current_box</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">current_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;DollarCents&quot;</span><span class="p">,</span> <span class="s2">&quot;Dollars&quot;</span><span class="p">):</span>
            <span class="n">raw_fill</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span> <span class="p">:</span> <span class="n">end_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">boxes</span><span class="p">[</span><span class="n">block_start</span><span class="p">][</span><span class="s2">&quot;block_fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_fill_string</span><span class="p">(</span><span class="n">raw_fill</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decimal</span> <span class="o">=</span> <span class="n">current_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;DollarCents&quot;</span>
            <span class="n">fill_val</span> <span class="o">=</span> <span class="n">current_box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fill_val</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">fill_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fill_val</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">current_box</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_money_space</span><span class="p">(</span><span class="n">fill_val</span><span class="p">,</span> <span class="n">decimal</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to format fill value &#39;</span><span class="si">{</span><span class="n">fill_val</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">current_box</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fill_val</span>
        <span class="n">boxes</span><span class="p">[</span><span class="n">end_idx</span><span class="p">][</span><span class="s2">&quot;gap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># No gap after the last box in the line</span>
        <span class="n">line_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">j</span>
    <span class="n">block_id_counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Group boxes by page number, only include blocks with length &gt;= 1, then sort by line and left coordinate</span>

    <span class="n">page_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">page_dict</span><span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="n">page_dict</span><span class="p">:</span>
        <span class="n">page_dict</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">page_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.layout.assign_numeric_blocks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_numeric_blocks</span><span class="p">(</span><span class="n">page_dict</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge and assign numeric block types based on heuristics of adjacency and length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>page_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyed by page number with boxes list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="typing.DefaultDict">DefaultDict</span>[<span title="int">int</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated page_dict with numeric block types assigned.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Modifies the page_dict in place:</p>
<ul>
<li>Merges runs of adjacent blocks of length 3 if gaps between them are small.</li>
<li>Optionally prepends certain preceding blocks to runs.</li>
<li>Assigns field types "CurrencyDecimal" or "Currency" based on heuristics.</li>
<li>Aggregates block lengths, widths, and concatenates fill strings.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/layout.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assign_numeric_blocks</span><span class="p">(</span>
    <span class="n">page_dict</span><span class="p">:</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge and assign numeric block types based on heuristics of adjacency and length.</span>

<span class="sd">    Args:</span>
<span class="sd">        page_dict (dict): Keyed by page number with boxes list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Updated page_dict with numeric block types assigned.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Modifies the page_dict in place:</span>

<span class="sd">        - Merges runs of adjacent blocks of length 3 if gaps between them are small.</span>
<span class="sd">        - Optionally prepends certain preceding blocks to runs.</span>
<span class="sd">        - Assigns field types &quot;CurrencyDecimal&quot; or &quot;Currency&quot; based on heuristics.</span>
<span class="sd">        - Aggregates block lengths, widths, and concatenates fill strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">page_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="n">page_dict</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">block_length</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">block_length</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">run</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c1"># Collect consecutive blocks of length 3 separated by small gaps</span>

                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
                    <span class="n">next_block_length</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">next_pgap</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pgap&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">next_block_length</span> <span class="o">==</span> <span class="mi">3</span>
                        <span class="ow">and</span> <span class="n">next_pgap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">next_pgap</span> <span class="o">&lt;</span> <span class="mi">8</span>
                    <span class="p">):</span>
                        <span class="n">run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="c1"># Optionally prepend preceding block if conditions met</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">prev</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">first_pgap</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pgap&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">prev</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">first_pgap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">first_pgap</span> <span class="o">&lt;</span> <span class="mi">8</span>
                    <span class="p">):</span>
                        <span class="n">run</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">next_idx</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">next_block_length</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">rows</span><span class="p">[</span><span class="n">next_idx</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">next_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="n">next_gap</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">next_idx</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pgap&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">next_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">next_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">next_block_length</span> <span class="o">==</span> <span class="mi">2</span>
                        <span class="ow">and</span> <span class="n">next_gap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="n">run</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">next_idx</span><span class="p">])</span>
                        <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;field_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CurrencyDecimal&quot;</span>
                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;field_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Currency&quot;</span>
                    <span class="c1"># Aggregate block length and width for the merged block</span>

                    <span class="n">block_length_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_length_sum</span>
                    <span class="n">first_left</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span><span class="p">)</span>
                    <span class="n">last_left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span><span class="p">)</span>
                    <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;block_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">last_left</span> <span class="o">-</span> <span class="n">first_left</span> <span class="o">+</span> <span class="n">run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;block_width&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">fills</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_fill&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_fill&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;block_fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fills</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c1"># Clear subordinate blocks lengths and fills</span>

                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">r</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">r</span><span class="p">[</span><span class="s2">&quot;block_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">r</span><span class="p">[</span><span class="s2">&quot;block_fill&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">page_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="flyfield.markup_and_fields" class="doc doc-heading">
            <code>flyfield.markup_and_fields</code>


</h2>

    <div class="doc doc-contents first">

        <p>Functions for PDF markup and form field annotation.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="flyfield.markup_and_fields.markup_pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">markup_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">page_dict</span><span class="p">,</span> <span class="n">output_pdf_path</span><span class="p">,</span> <span class="n">mark_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mark_radius</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Mark PDF with circles and codes at block locations for debugging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pages and boxes with layout info.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output marked PDF file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mark_color</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RGB float tuple for marker color.</p>
              </div>
            </td>
            <td>
                  <code>(0, 0, 1)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mark_radius</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Radius of circle marks.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/markup_and_fields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">markup_pdf</span><span class="p">(</span>
    <span class="n">pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">page_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]],</span>
    <span class="n">output_pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mark_color</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">mark_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mark PDF with circles and codes at block locations for debugging.</span>

<span class="sd">    Args:</span>
<span class="sd">        pdf_path (str): Input PDF file.</span>
<span class="sd">        page_dict (dict): Pages and boxes with layout info.</span>
<span class="sd">        output_pdf_path (str): Output marked PDF file path.</span>
<span class="sd">        mark_color (tuple): RGB float tuple for marker color.</span>
<span class="sd">        mark_radius (int or float): Radius of circle marks.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to open PDF for markup: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">boxes</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">page_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">PDF_PAGES</span> <span class="ow">and</span> <span class="n">page_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">PDF_PAGES</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">page_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">page_height</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">height</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">new_shape</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="c1"># Only mark boxes that have a meaningful block_length</span>

            <span class="k">if</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;block_length&quot;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y_raw</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x0&quot;</span><span class="p">),</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y0&quot;</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">page_height</span> <span class="o">-</span> <span class="n">y_raw</span>
                <span class="n">shape</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">mark_radius</span><span class="p">)</span>

                <span class="n">point</span> <span class="o">=</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">shape</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span>
                    <span class="n">point</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)),</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">mark_color</span><span class="p">,</span>
                    <span class="n">morph</span><span class="o">=</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">fitz</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">prerotate</span><span class="p">(</span><span class="mi">45</span><span class="p">)),</span>
                <span class="p">)</span>
        <span class="n">shape</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">mark_color</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">shape</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_pdf_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save output PDF: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.markup_and_fields.adjust_form_boxes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">adjust_form_boxes</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">block_length</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adjust the position and width of form boxes depending on field type and block length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Box attributes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original block width.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>block_length</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Block length in contained boxes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(adjusted x, adjusted width, list of extra args)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/markup_and_fields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">adjust_form_boxes</span><span class="p">(</span>
    <span class="n">row</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">block_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust the position and width of form boxes depending on field type and block length.</span>

<span class="sd">    Args:</span>
<span class="sd">        row (dict): Box attributes.</span>
<span class="sd">        width (float): Original block width.</span>
<span class="sd">        block_length (int): Block length in contained boxes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (adjusted x, adjusted width, list of extra args)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">])</span>
    <span class="n">field_type</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span>
    <span class="n">extra_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;alignment=2&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">block_length</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">and</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">14</span>
        <span class="ow">and</span> <span class="n">field_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Currency&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="c1"># Reduce width by size of layout characters</span>

        <span class="n">width_adjusted</span> <span class="o">=</span> <span class="n">width</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;Dollars&quot;</span><span class="p">:</span>
            <span class="n">width_adjusted</span> <span class="o">-=</span> <span class="mi">21</span>
        <span class="k">elif</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;DollarCents&quot;</span><span class="p">:</span>
            <span class="n">width_adjusted</span> <span class="o">-=</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width_adjusted</span><span class="p">),</span> <span class="n">extra_args</span>
    <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Currency&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">):</span>
        <span class="n">gap_adj</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">GAP</span> <span class="o">+</span> <span class="n">GAP_GROUP</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">gap_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">gap_adj</span> <span class="o">*</span> <span class="p">(((</span><span class="n">block_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">F</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">:</span>
            <span class="n">gap_start</span> <span class="o">+=</span> <span class="n">F</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">gap_end</span> <span class="o">=</span> <span class="n">gap_adj</span> <span class="o">+</span> <span class="n">F</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;Currency&quot;</span> <span class="k">else</span> <span class="p">(</span><span class="n">gap_adj</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gap_adj</span> <span class="o">=</span> <span class="n">GAP</span>
        <span class="n">gap_start</span> <span class="o">=</span> <span class="n">gap_end</span> <span class="o">=</span> <span class="n">gap_adj</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">F</span>
        <span class="n">extra_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;alignment=0&quot;</span>
    <span class="n">x</span> <span class="o">-=</span> <span class="n">gap_start</span>
    <span class="n">width_adjusted</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="n">gap_start</span> <span class="o">+</span> <span class="n">gap_end</span>
    <span class="n">extra_args</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;max_length=</span><span class="si">{</span><span class="n">block_length</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">block_length</span> <span class="k">else</span> <span class="s2">&quot;max_length=None&quot;</span><span class="p">,</span>
        <span class="s2">&quot;comb=True&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width_adjusted</span><span class="p">),</span> <span class="n">extra_args</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.markup_and_fields.generate_form_fields_script" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_form_fields_script</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">input_pdf</span><span class="p">,</span> <span class="n">output_pdf_with_fields</span><span class="p">,</span> <span class="n">script_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a standalone Python script to create PDF form fields from CSV block data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CSV data path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_pdf</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input PDF to annotate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_pdf_with_fields</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output annotated PDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>script_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output script file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated script file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/markup_and_fields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_form_fields_script</span><span class="p">(</span>
    <span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">input_pdf</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_pdf_with_fields</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">script_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a standalone Python script to create PDF form fields from CSV block data.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_path (str): CSV data path.</span>
<span class="sd">        input_pdf (str): Input PDF to annotate.</span>
<span class="sd">        output_pdf_with_fields (str): Output annotated PDF.</span>
<span class="sd">        script_path (str): Output script file path.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated script file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;from PyPDFForm import Fields, PdfWrapper&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">&#39;pdf = PdfWrapper(&quot;</span><span class="si">{</span><span class="n">input_pdf</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">current_page</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="n">page_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;page_num&quot;</span><span class="p">])</span>

                <span class="c1"># Skip rows whose page number is not in PDF_PAGES if PDF_PAGES filter is set</span>

                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">PDF_PAGES</span> <span class="ow">and</span> <span class="n">page_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">PDF_PAGES</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">code</span>
                    <span class="ow">or</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Skip&quot;</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">page_number</span> <span class="o">!=</span> <span class="n">current_page</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;print(&quot;Starting page </span><span class="si">{</span><span class="n">page_number</span><span class="si">}</span><span class="s1">...&quot;, flush=True)&#39;</span><span class="p">)</span>
                    <span class="n">current_page</span> <span class="o">=</span> <span class="n">page_number</span>
                <span class="n">block_length</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_length&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
                    <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">width</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_width&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_width&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
                    <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">width_adjusted</span><span class="p">,</span> <span class="n">extra_args</span> <span class="o">=</span> <span class="n">adjust_form_boxes</span><span class="p">(</span>
                    <span class="n">row</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">block_length</span>
                <span class="p">)</span>
                <span class="n">sanitized_code</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^\w\-_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
                <span class="n">base_args</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="c1">#                    &#39;widget_type=&quot;text&quot;&#39;,</span>
                    <span class="sa">f</span><span class="s1">&#39;name=&quot;</span><span class="si">{</span><span class="n">sanitized_code</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;page_number=</span><span class="si">{</span><span class="n">page_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;x=</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;y=</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;height=</span><span class="si">{</span><span class="n">height</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;width=</span><span class="si">{</span><span class="n">width_adjusted</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;bg_color=(0,0,0,0)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;border_color=(0,0,0,0)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;border_width=0&quot;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">base_args</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">]</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pdf.create_field(Fields.TextField(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">))&quot;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;pdf.write(&quot;</span><span class="si">{</span><span class="n">output_pdf_with_fields</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;print(&quot;Created form fields PDF.&quot;, flush=True)&#39;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to generate form fields script: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">script_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.markup_and_fields.run_standalone_script" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_standalone_script</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Execute a standalone script for PDF form field creation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>script_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the script to run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/markup_and_fields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_standalone_script</span><span class="p">(</span><span class="n">script_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute a standalone script for PDF form field creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        script_path (str): Path to the script to run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running generated form field creation script: </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s2">&quot;-u&quot;</span><span class="p">,</span> <span class="n">script_path</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Generated script failed with exit code </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running generated script: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.markup_and_fields.run_fill_pdf_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_fill_pdf_fields</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">output_pdf_path</span><span class="p">,</span> <span class="n">template_pdf_path</span><span class="p">,</span> <span class="n">generator_script_path</span><span class="p">,</span> <span class="n">boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates and runs a standalone Python script to fill PDF form fields using PyPDFForm,</p>
<p>based on data from a CSV file with 'code' and 'fill' columns.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>csv_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the CSV input file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the filled PDF should be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_pdf_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the input (template) PDF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>generator_script_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path where the generated fill script will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/markup_and_fields.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_fill_pdf_fields</span><span class="p">(</span>
    <span class="n">csv_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">template_pdf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">generator_script_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">boxes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates and runs a standalone Python script to fill PDF form fields using PyPDFForm,</span>

<span class="sd">    based on data from a CSV file with &#39;code&#39; and &#39;fill&#39; columns.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_path (str): Path to the CSV input file.</span>
<span class="sd">        output_pdf_path (str): Path where the filled PDF should be saved.</span>
<span class="sd">        template_pdf_path (str): Path to the input (template) PDF file.</span>
<span class="sd">        generator_script_path (str): Path where the generated fill script will be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_money_space</span><span class="p">,</span> <span class="n">parse_money_space</span>

    <span class="n">fill_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="c1"># Clean row values</span>

                <span class="n">stripped_row</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">stripped_row</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">continue</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped_row</span><span class="p">)</span>
        <span class="c1"># Flatten boxes if any and merge to rows</span>

        <span class="k">if</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="n">flat_boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">boxes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
            <span class="n">conditional_merge_list</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">flat_boxes</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;field_type&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">)</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Dollars&quot;</span><span class="p">,</span> <span class="s2">&quot;DollarCents&quot;</span><span class="p">):</span>
                <span class="n">decimal</span> <span class="o">=</span> <span class="n">field_type</span> <span class="o">==</span> <span class="s2">&quot;DollarCents&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">amount</span> <span class="o">=</span> <span class="n">parse_money_space</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">format_money_space</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Warning: Could not format value &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39; for field_type &#39;</span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Currency&quot;</span><span class="p">,</span> <span class="s2">&quot;CurrencyDecimal&quot;</span><span class="p">):</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">fill_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading CSV </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">fill_dict_items</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fill_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">script_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">from PyPDFForm import PdfWrapper</span>
<span class="s2">print(&quot;Starting to fill PDF fields...&quot;, flush=True)</span>
<span class="s2">try:</span>
<span class="s2">    filled = PdfWrapper(</span>
<span class="s2">        &quot;</span><span class="si">{</span><span class="n">template_pdf_path</span><span class="si">}</span><span class="s2">&quot;,</span>
<span class="s2">        adobe_mode=False</span>
<span class="s2">    ).fill(</span>
<span class="s2">        </span><span class="se">{{</span>
<span class="s2">            </span><span class="si">{</span><span class="n">fill_dict_items</span><span class="si">}</span>
<span class="s2">        </span><span class="se">}}</span><span class="s2">,</span>
<span class="s2">        flatten=False</span>
<span class="s2">    )</span>
<span class="s2">    filled.write(&quot;</span><span class="si">{</span><span class="n">output_pdf_path</span><span class="si">}</span><span class="s2">&quot;)</span>
<span class="s2">    print(&quot;Filled PDF saved to </span><span class="si">{</span><span class="n">output_pdf_path</span><span class="si">}</span><span class="s2">&quot;, flush=True)</span>
<span class="s2">except Exception as e:</span>
<span class="s2">    print(f&quot;Exception during filling: </span><span class="se">{{</span><span class="s2">e</span><span class="se">}}</span><span class="s2">&quot;, file=sys.stderr, flush=True)</span>
<span class="s2">    sys.exit(1)</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">generator_script_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">script_file</span><span class="p">:</span>
            <span class="n">script_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">script_content</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated fill script saved to </span><span class="si">{</span><span class="n">generator_script_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error writing fill script to </span><span class="si">{</span><span class="n">generator_script_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">generator_script_path</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fill script stdout:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fill script stderr:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fill script failed with exit code </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fill script completed successfully.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error running fill script: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="flyfield.utils" class="doc doc-heading">
            <code>flyfield.utils</code>


</h2>

    <div class="doc doc-contents first">

        <p>General utility functions.</p>
<p>Helper functions for parsing, formatting, and validation.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.add_suffix_to_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_suffix_to_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a suffix before the file extension in a filename.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original filename.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suffix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Suffix to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename with suffix added.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_suffix_to_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a suffix before the file extension in a filename.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): Original filename.</span>
<span class="sd">        suffix (str): Suffix to add.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Filename with suffix added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.colour_match" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">colour_match</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">target_color</span><span class="o">=</span><span class="n">TARGET_COLOUR</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a color matches a target within a tolerance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>color</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RGB color tuple.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_color</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RGB target color.</p>
              </div>
            </td>
            <td>
                  <code><span title="flyfield.config.COLOR_WHITE">COLOR_WHITE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tol</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Allowed tolerance.</p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if colors match within tolerance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>If the input color has an alpha channel (RGBA), the alpha component is ignored.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">colour_match</span><span class="p">(</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">target_color</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">TARGET_COLOUR</span><span class="p">,</span>
    <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if a color matches a target within a tolerance.</span>

<span class="sd">    Args:</span>
<span class="sd">        color (tuple): RGB color tuple.</span>
<span class="sd">        target_color (tuple): RGB target color.</span>
<span class="sd">        tol (float): Allowed tolerance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if colors match within tolerance.</span>

<span class="sd">    Note:</span>
<span class="sd">        If the input color has an alpha channel (RGBA), the alpha component is ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Compare only RGB channels; ignore alpha if present</span>

    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">color</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">target_color</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.int_to_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">int_to_rgb</span><span class="p">(</span><span class="n">color_int</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert a 24-bit integer color in 0xRRGGBB format to normalized RGB tuple of floats.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>color_int</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer encoding color as 0xRRGGBB.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized (r, g, b) floats in range [0.0, 1.0].</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">int_to_rgb</span><span class="p">(</span><span class="n">color_int</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a 24-bit integer color in 0xRRGGBB format to normalized RGB tuple of floats.</span>

<span class="sd">    Args:</span>
<span class="sd">        color_int (int): Integer encoding color as 0xRRGGBB.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Normalized (r, g, b) floats in range [0.0, 1.0].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">color_int</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">((</span><span class="n">color_int</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">color_int</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.clean_fill_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_fill_string</span><span class="p">(</span><span class="n">line_text</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Clean a concatenated fill text string by removing single spaces while preserving double spaces as single spaces.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>line_text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw line text.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cleaned fill string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clean_fill_string</span><span class="p">(</span><span class="n">line_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean a concatenated fill text string by removing single spaces while preserving double spaces as single spaces.</span>

<span class="sd">    Args:</span>
<span class="sd">        line_text (str): Raw line text.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Cleaned fill string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; {2,}&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&lt;&lt;SPACE&gt;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">line_text</span><span class="p">)</span>
    <span class="n">line_text</span> <span class="o">=</span> <span class="n">line_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">line_text</span> <span class="o">=</span> <span class="n">line_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;&lt;&lt;SPACE&gt;&gt;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line_text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.allowed_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allowed_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">field_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Determine if text is allowed based on predefined rules and field type.</p>
<p>Helps to filter out pre-filled or invalid box contents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text extracted from a box.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional current field type guess to refine allowed patterns.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="bool">bool</span>, <span title="typing.Optional">Optional</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(bool indicating if allowed, detected field type or None)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">allowed_text</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if text is allowed based on predefined rules and field type.</span>

<span class="sd">    Helps to filter out pre-filled or invalid box contents.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Text extracted from a box.</span>
<span class="sd">        field_type (str or None): Optional current field type guess to refine allowed patterns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (bool indicating if allowed, detected field type or None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allowed_text_by_type</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;DollarCents&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;.00.&quot;</span><span class="p">},</span>
        <span class="s2">&quot;Dollars&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;.00&quot;</span><span class="p">,</span> <span class="s2">&quot;.00.00&quot;</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="n">generic_allowed_text</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">allowed_text_by_type</span><span class="p">:</span>
        <span class="n">allowed_set</span> <span class="o">=</span> <span class="n">allowed_text_by_type</span><span class="p">[</span><span class="n">field_type</span><span class="p">]</span> <span class="o">|</span> <span class="n">generic_allowed_text</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">allowed_set</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">field_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">texts</span> <span class="ow">in</span> <span class="n">allowed_text_by_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ftype</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">generic_allowed_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.format_money_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_money_space</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Format a numeric amount to a string with space-separated thousands and optional decimal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>amount</code>
            </td>
            <td>
                  <code><span title="float">float</span> or <span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numeric amount to format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include two decimal places.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Formatted monetary string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">format_money_space</span><span class="p">(</span><span class="n">amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">decimal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Format a numeric amount to a string with space-separated thousands and optional decimal.</span>

<span class="sd">    Args:</span>
<span class="sd">        amount (float or int): Numeric amount to format.</span>
<span class="sd">        decimal (bool): Whether to include two decimal places.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Formatted monetary string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decimal</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">amount</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">int_part</span><span class="p">,</span> <span class="n">dec_part</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">int_part</span> <span class="o">=</span> <span class="n">int_part</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">int_part</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dec_part</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">int_part</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">int_part</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.parse_money_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_money_space</span><span class="p">(</span><span class="n">money_str</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a monetary string with optional implied decimal space formatting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>money_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Monetary string to parse (e.g., "12 345" means 123.45 if decimal is True).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the last two digits represent cents (default True).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed monetary value as a float.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_money_space</span><span class="p">(</span><span class="n">money_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">decimal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a monetary string with optional implied decimal space formatting.</span>

<span class="sd">    Args:</span>
<span class="sd">        money_str (str): Monetary string to parse (e.g., &quot;12 345&quot; means 123.45 if decimal is True).</span>
<span class="sd">        decimal (bool): Whether the last two digits represent cents (default True).</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Parsed monetary value as a float.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decimal</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">money_str</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">money_str</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">int_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">dec_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">int_part</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_part</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No decimal part found, treat as int</span>

            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">money_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">money_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.parse_implied_decimal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_implied_decimal</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a numeric string with implied decimal (last two digits as decimals).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numeric string (e.g., "12345" -&gt; 123.45).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parsed float value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_implied_decimal</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a numeric string with implied decimal (last two digits as decimals).</span>

<span class="sd">    Args:</span>
<span class="sd">        s (str): Numeric string (e.g., &quot;12345&quot; -&gt; 123.45).</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Parsed float value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">digits_only</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\D&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">digits_only</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits_only</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># If only 1 or 2 digits, treat as fractional part</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0.</span><span class="si">{</span><span class="n">digits_only</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">digits_only</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">digits_only</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">version</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the current version string of the library/module.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Version string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the current version string of the library/module.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Version string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Python 3.8+</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageNotFoundError</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span> <span class="k">as</span> <span class="n">pkg_version</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># For Python &lt;3.8</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib_metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageNotFoundError</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">importlib_metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span> <span class="k">as</span> <span class="n">pkg_version</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pkg_version</span><span class="p">(</span><span class="s2">&quot;flyfield&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.parse_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_pages</span><span class="p">(</span><span class="n">pages_str</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a string specifying pages or page ranges into a list of page integers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pages_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pages specified as a comma-separated list or ranges (e.g., "1,3-5").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[int]: List of individual page numbers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_pages</span><span class="p">(</span><span class="n">pages_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse a string specifying pages or page ranges into a list of page integers.</span>

<span class="sd">    Args:</span>
<span class="sd">        pages_str (str): Pages specified as a comma-separated list or ranges (e.g., &quot;1,3-5&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[int]: List of individual page numbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">pages_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
            <span class="n">start_str</span><span class="p">,</span> <span class="n">end_str</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_str</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_str</span><span class="p">)</span>
            <span class="n">pages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">part</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="flyfield.utils.conditional_merge_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">conditional_merge_list</span><span class="p">(</span><span class="n">main_list</span><span class="p">,</span> <span class="n">ref_list</span><span class="p">,</span> <span class="n">match_key</span><span class="p">,</span> <span class="n">keys_to_merge</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Conditionally merge dictionaries in a main list with those in a reference list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>main_list</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Primary list of dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ref_list</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference list of dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>match_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key to match dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keys_to_merge</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keys to merge from ref_list into main_list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Modifies main_list in place.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>flyfield/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">conditional_merge_list</span><span class="p">(</span>
    <span class="n">main_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
    <span class="n">ref_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
    <span class="n">match_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">keys_to_merge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conditionally merge dictionaries in a main list with those in a reference list.</span>

<span class="sd">    Args:</span>
<span class="sd">        main_list (list[dict]): Primary list of dictionaries.</span>
<span class="sd">        ref_list (list[dict]): Reference list of dictionaries.</span>
<span class="sd">        match_key (str): Key to match dictionaries.</span>
<span class="sd">        keys_to_merge (list[str]): Keys to merge from ref_list into main_list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: Modifies main_list in place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build lookup dictionary for efficient matching</span>

    <span class="n">ref_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="n">match_key</span><span class="p">]:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ref_list</span> <span class="k">if</span> <span class="n">match_key</span> <span class="ow">in</span> <span class="n">item</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">main_list</span><span class="p">:</span>
        <span class="n">ref_record</span> <span class="o">=</span> <span class="n">ref_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">match_key</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ref_record</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_merge</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ref_record</span><span class="p">:</span>
                    <span class="n">record</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_record</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="faq.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: FAQ">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                FAQ
              </div>
            </div>
          </a>
        
        
          
          <a href="config.html" class="md-footer__link md-footer__link--next" aria-label="Next: Configuration">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Configuration
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.footer", "content.action.edit"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>